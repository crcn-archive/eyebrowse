#!/usr/bin/env node

process.env.APUPPET_LOG=1
var commander = require("commander"),
eyebrowse       = require("..")

commander.
option("-c, --config <path>", "eyebrowse configuration file", String, "/usr/local/etc/eyebrowse/config");

function initClient() {
  return new eyebrowse.Client(require(commander.config.replace(/^\./, process.cwd()).replace("~", process.env.HOME)));
}


//start an application
commander.
command("start <appName> [args]").
description("starts an application").
action(function(app) {

  var args  = process.argv.slice(4);

  initClient().start({ name: app,  args: args }, function(e) {
    if(e) console.error(e.stack);
  });
});

//list all available browsers
commander.
command("list").
description("starts an application").
action(function(app) {

  var args  = process.argv.slice(4);

  initClient().getAvailableBrowsers(function(e, browsers) {
    if(e) console.error(e.stack);
    for(var i = browsers.length; i--;) {
      var browser = browsers[i];
      console.log(browser.name + " - " + browser.versions.join(", "))
    }
  });
});


//start the server which launches browsers
commander.
command("server").
description("starts the app server").
action(function() {

});



commander.parse(process.argv);